services:
  # Next.js Application
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: wms-app
    restart: unless-stopped
    ports:
      - "3000:3000"
    # PRODUCTION MODE: No volume mounts - uses built standalone image from Dockerfile
    # Volume mounts would overwrite the built files and cause "next: not found" errors
    # For development with hot-reload, uncomment volumes below and change command to "npm run dev"
    # volumes:
    #   - ./:/app
    #   - /app/node_modules
    #   - /app/.next
    env_file:
      - .env
    environment:
      DATABASE_URL: ${DATABASE_URL}
      NEXTAUTH_SECRET: ${NEXTAUTH_SECRET:-$(openssl rand -base64 32)}
      NEXTAUTH_URL: ${NEXTAUTH_URL:-http://localhost:3000}
      AUTH_TRUST_HOST: "true"
      NEXT_PUBLIC_COMPANY_NAME: ${NEXT_PUBLIC_COMPANY_NAME:-Fresh Farm Logic LLC}
      NEXT_PUBLIC_COMPANY_ADDRESS: ${NEXT_PUBLIC_COMPANY_ADDRESS:-1234 Produce Lane, Salinas, CA}
      # QuickBooks Online Integration
      QBO_CLIENT_ID: ${QBO_CLIENT_ID}
      QBO_CLIENT_SECRET: ${QBO_CLIENT_SECRET}
      QBO_REDIRECT_URI: ${QBO_REDIRECT_URI:-http://localhost:3000/api/auth/qbo/callback}
      QBO_ENVIRONMENT: ${QBO_ENVIRONMENT:-sandbox}
      NODE_ENV: production
    # Use production build (standalone mode) - server.js is in the built image
    networks:
      - wms-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  wms-network:
    driver: bridge

